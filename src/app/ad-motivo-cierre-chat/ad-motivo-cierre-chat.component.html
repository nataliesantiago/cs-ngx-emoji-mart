<div class="general-container">
    <mat-card *ngIf="is_created" class="mat-card-root">  
        <mat-card-content class="mat-card-content-root">
        
            <h3>Formulario de Motivo Cierre del Chat</h3>
            <hr>
            <div fxLayout="row wrap">
            <div fxFlex="100" class="m-b-20">
                <br>
                <mat-form-field>
                <mat-label>Digite el motivo del cierre</mat-label>
                <input matInput [(ngModel)]="reason.name" name="name" autocomplete="off">
                </mat-form-field>

                <mat-form-field class="example-full-width">
                    <input type="text" placeholder="Selecciona una categoría de experticia" matInput
                        [formControl]="reason_control" [matAutocomplete]="auto" autocomplete="off"/>
                    <button mat-button *ngIf="reason_control.value" matSuffix mat-icon-button aria-label="Clear"
                        (click)="reason_control.setValue('')">
                        <mat-icon>close</mat-icon>
                    </button>
                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)='seleccionarCategoriaNueva($event.option.value)'>
                        <mat-option *ngFor="let option of filtered_options | async" [value]="option">
                        {{option.nombre}}
                        </mat-option>
                    </mat-autocomplete>
                </mat-form-field>
            </div>
            </div>
                
            <div fxLayout="row wrap">
            <div fxFlex="25" fxLayoutAlign="space-between center" class="responsive-btn">
                <button fxFlex="45" class="custom__btn custom__btn--accept" (click)="saveOneReason()">Guardar</button>
                <a fxFlex="45" class="custom__btn custom__btn--cancel" (click)="is_created = !is_created">Cancelar</a>
            </div>
            </div>
        </mat-card-content>
    </mat-card>

    <div fxLayout="row wrap">
        <div fxFlex.gt-sm="100" fxFlex.gt-xs="100" fxFlex="100">
                
            <mat-card class="mat-card-root">
                <mat-card-content class="mat-card-content-root">
                    <br>
                    <button class="custom__btn custom__btn--primary" (click)="is_created = !is_created" *ngIf="!is_created">
                        <mat-icon>add</mat-icon>
                        Ingresar Motivos de Cierre 
                    </button>
                    <br>
                    <mat-card-title>Motivos Cierre de Chat</mat-card-title>
                    
                    
                    <div class="container-filter">
                        <div class="element-filter element-filter-1">
                            <mat-form-field>
                                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filtrar busqueda">
                                <mat-icon class="search-icon">search</mat-icon>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="responsive-table">
                        
                        <mat-table [dataSource]="dataSource" matSort>

                            <ng-container matColumnDef="actions">
                                <mat-header-cell *matHeaderCellDef mat-sort-header style="max-width:20%;"> Acciones </mat-header-cell>
                                <mat-cell *matCellDef="let row" style="max-width:20%;">
                                    <div *ngIf="!row.update">
                                        <i class="ti-pencil info-color m-r-10 mouse-over" (click)="editReason(row)"></i>
                                        <i class="ti-trash danger-color m-r-10 mouse-over" (click)="deleteReason(row)"></i>
                                    </div>
                                    <div *ngIf="row.update">
                                        <i class="ti-save success-color m-r-10 mouse-over" (click)="updateReason(row)"></i>
                                        <i class="ti-close danger-color m-r-10 mouse-over" (click)="cancelUpdate(row)"></i>
                                    </div>
                                </mat-cell>
                            </ng-container>
    
                            <!-- ID Column -->
                            <ng-container matColumnDef="id">
                                <mat-header-cell *matHeaderCellDef mat-sort-header style="max-width:15%;"> ID </mat-header-cell>
                                <mat-cell *matCellDef="let row" style="max-width:15%;"> {{row.idtbl_motivo_cierre_chat}} </mat-cell>
                            </ng-container>
    
                            <!-- name Column -->
                            <ng-container matColumnDef="name">
                                <mat-header-cell *matHeaderCellDef mat-sort-header style="max-width:65%;"> Motivo de cierre </mat-header-cell>
                                <mat-cell *matCellDef="let row" style="max-width:65%;"> 
                                    <span *ngIf="!row.update">{{row.nombre}}</span>
                                    <mat-form-field *ngIf="row.update">
                                        <input matInput type="text" name="name" [(ngModel)]="row.texto_tmp" autocomplete="off">
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="category">
                                <mat-header-cell *matHeaderCellDef mat-sort-header style="max-width:65%;"> Categoría de Experticia </mat-header-cell>
                                <mat-cell *matCellDef="let row" style="max-width:65%;"> 
                                    <span *ngIf="!row.update">{{row.categoria}}</span>
                                    <mat-form-field *ngIf="row.update">
                                        <input type="text" placeholder="Selecciona una categoría" aria-label="Number" matInput
                                            [formControl]="edit_reason_control" [matAutocomplete]="auto" autocomplete="off"/>
                                        <button mat-button *ngIf="edit_reason_control.value" matSuffix mat-icon-button aria-label="Clear"
                                            (click)="edit_reason_control.setValue('')">
                                            <mat-icon>close</mat-icon>
                                        </button>
                                        <mat-autocomplete #auto="matAutocomplete" (optionSelected)='selectEditCategory($event.option.value, row)'>
                                            <mat-option *ngFor="let option of edit_filtered_options | async" [value]="option">
                                            {{option.nombre}}
                                            </mat-option>
                                        </mat-autocomplete>
                                    </mat-form-field>
                                </mat-cell>
                            </ng-container>

                            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns;">
                            </mat-row>
                        </mat-table>
    
                        <mat-paginator [pageSizeOptions]="[50, 100, 200]"></mat-paginator>
                    </div>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
</div>